{% extends 'core/base.html' %}
{% load humanize %}
{% load mention %}
{% load convert_markdown %}

{% load static %}
{% block title %}
{{ usr.get_full_name }} (@{{ usr.username }})
{% endblock title %}
{% block content %}
<div class="columns">
    <div class="column is-7">
        <div class="card">
            {% if usr.profile.header_image %}
            <div class="card-image">
                <figure class="image 16by9">
                    <img src="{{usr.profile.header_image.url}}" alt="Placeholder image">
                </figure>
            </div>
            {% endif %}
            <div class="card-content">
                
                <div class="media">
                    <div class="media-left">
                        <figure class="image is-96x96 is-square">
                    <img class="is-rounded" src="{{ usr.profile.get_image_url }}">
                </figure>
                    </div>
                    <div class="media-content">

                        <h4 class="title is-4 has-text-weight-bold">{{ usr.get_full_name }}
                            {% if usr.profile.verified %}
                            <span class="is-small" style="color: rgb(46, 206, 107);">
                                ‚úîÔ∏è
                            </span>
                            {% endif %}
                        </h4>
                        <p class="subtitle"><a>@{{usr.username}}</a>
                            {% if usr.is_superuser %}
                            <span class="tag is-rounded">Co-Founder¬†‚úîÔ∏è</span>
                            {% endif %}
                            {% if usr.is_staff %}
                            <span class="tag is-rounded">Staff¬†‚úîÔ∏è</span>
                            {% endif %}
                            
                            {% for badge in usr.profile.badges.all %}
                            <a href="{% url 'badge' badge.id %}"><span class="tag is-rounded is-{{badge.color}}">{{ badge.name }}</span></a>
                            {% endfor %}
                                
                        </p>
                        
                    </div>
                </div>
                <p>
                    Followers: <a href="{% url 'followers' usr.username %}">{{ usr.profile.follower_count }}</a>
                    <br>
                    Following: <a href="{% url 'following' usr.username %}">{{ usr.profile.following_count }}</a>
                </p>
                <br>
                <p class="content">
                    {{ usr.profile.bio | mention | safe | convert_markdown}}
                </p>
                <br>
                <div class="buttons">


                    {% if user == usr %}

                    <a href="{% url 'profile' %}" class="button is-link is-rounded">Edit Profile¬†¬†üìù</a>                        
                    {% else %}

                    {% if not usr.profile in user.profile.follows.all %}
                    <form action="{% url 'follow' %}" method="GET">

                        <input type="hidden" name="username" value="{{ usr.username }}">
                        <button class="button is-link is-rounded" type="submit">Follow¬†¬†‚ûï</button>
                    </form>
                    {% else %}
                    <form action="{% url 'unfollow' %}" method="GET">

                        <input type="hidden" name="username" value="{{ usr.username }}">
                        <button class="button is-link is-rounded" type="submit">Unfollow¬†¬†‚ûñ</button>
                    </form>
                    {% endif %}
                    {% endif %}

                    {% if not usr == user %}
                    ¬†¬†<a href="{% url 'message_user' usr.username %}" class="button is-warning">Message¬†¬†üì®</a>

                    {% endif %}

                </div>
            </div>
        </div>
        <br>
        {% for vit in vits %}
        {% include 'vit/extends/vit_block.html' %}
        {% endfor %}
        <div class="pagination">
            <span class="step-links">
                {% if vits.has_previous %}
                <a href="?page=1">&laquo; first</a>
                <a href="?page={{ vits.previous_page_number }}">previous</a>
                {% endif %}
                <span class="current">
                    Page {{ vits.number }} of {{ vits.paginator.num_pages }}.
                </span>
                {% if vits.has_next %}
                <a href="?page={{ vits.next_page_number }}">next</a>
                <a href="?page={{ vits.paginator.num_pages }}">last &raquo;</a>
                {% endif %}
            </span>
        </div>
    </div>
    <div class="column is-5">
        {% include 'core/extends/side_block.html' %}
    </div>
    {% endblock content %}


    {% block script %}
    <script>
        // Just a simple script which sends the server to like a post
        // for more info please see apps/vit/api.py
        function like_vit(vit_id) {
            fetch(`/api/v1/vit/add_like/?vit_pk=${vit_id}`, {
                method: 'GET',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}',
                    'type': 'application/json'
                }
            }).then(function (response) {
                return response.json();
            }).then(function (data) {
                if (data.status == 'success') {
                    var like_count = document.getElementById('like_count_' + vit_id);
                    like_count.innerHTML = data.like_count;
                    var like_count = document.getElementById('like_count_' + vit_id);
                    like_count.innerHTML = data.likes;
                }
            });
        }
    </script>
    {% endblock script %}
